<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <title>{% block title %}Dleohr - Dashboard{% endblock %}</title>
    <link rel="shortcut icon" href="{{ asset('back/img/favicon.png') }}">
    {% block stylesheets %}
        <link rel="stylesheet" href="{{ asset('back/css/bootstrap.min.css') }}">
        <link rel="stylesheet" href="{{ asset('back/plugins/fontawesome/css/fontawesome.min.css') }}">
        <link rel="stylesheet" href="{{ asset('back/plugins/fontawesome/css/all.min.css') }}">
        <link rel="stylesheet" href="{{ asset('back/css/style.css') }}">
    {% endblock %}
</head>
<body>
    <div class="main-wrapper">
        {% include 'dashboard/sidebarManager.html.twig' %}
        
        <div class="page-wrapper" id="content-wrapper">
            {% block content %}{% endblock %}
        </div>
    </div>

    {% block javascripts %}
        <script src="{{ asset('back/js/jquery-3.6.0.min.js') }}"></script>
        <script src="{{ asset('back/js/popper.min.js') }}"></script>
        <script src="{{ asset('back/js/bootstrap.min.js') }}"></script>
        <script src="{{ asset('back/js/feather.min.js') }}"></script>
        <script src="{{ asset('back/plugins/slimscroll/jquery.slimscroll.min.js') }}"></script>
        <script src="{{ asset('back/plugins/apexchart/apexcharts.min.js') }}"></script>
        <script src="{{ asset('back/plugins/apexchart/chart-data.js') }}"></script>
        <script src="{{ asset('back/js/script.js') }}"></script>
        <script>
            $(document).ready(function() {
                // Handle sidebar navigation
                $('.sidebar-menu a').on('click', function(e) {
                    e.preventDefault();
                    var url = $(this).attr('href');
                    
                    $.ajax({
                        url: url,
                        method: 'GET',
                        success: function(response) {
                            // Extract content from the response
                            var content = $(response).find('.page-wrapper').html() || 
                                        $(response).filter('.page-wrapper').html() ||
                                        $(response).find('#content-wrapper').html();
                            if (content) {
                                $('#content-wrapper').html(content);
                                feather.replace();
                                $('.sidebar-menu li').removeClass('active');
                                $(e.target).closest('li').addClass('active');
                                // Update browser URL without reloading
                                window.history.pushState({}, document.title, url);
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error('Error loading content:', error);
                        }
                    });
                });

                // Handle browser back/forward buttons
                $(window).on('popstate', function() {
                    $.ajax({
                        url: window.location.pathname,
                        method: 'GET',
                        success: function(response) {
                            var content = $(response).find('.page-wrapper').html() || 
                                        $(response).filter('.page-wrapper').html() ||
                                        $(response).find('#content-wrapper').html();
                            if (content) {
                                $('#content-wrapper').html(content);
                                feather.replace();
                            }
                        }
                    });
                });

                // Set initial active state
                var currentPath = window.location.pathname;
                $('.sidebar-menu a').each(function() {
                    if ($(this).attr('href') === currentPath) {
                        $(this).closest('li').addClass('active');
                    }
                });
            });
        </script>



<script>
    document.addEventListener('DOMContentLoaded', function() {
        function getCookie(name) {
            let cookieArray = document.cookie.split('; ');
            let cookie = cookieArray.find(row => row.startsWith(name + '='));
            return cookie ? cookie.split('=')[1] : null;
        }


        fetch('/jwt/user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ token: getCookie('BEARER') }) // Get the token from cookies
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const user = data.user;
                document.getElementById('user-profile-image').src = user.imageprofil || "{{ asset('back/img/profile.jpg') }}";

                document.getElementById('user-full-name').textContent = user.nom + ' ' + user.prenom;
                document.getElementById('user-profile-link').href = '/user/' + user.iduser;

                const sidebarLinks = document.getElementById('sidebar-links');
                sidebarLinks.innerHTML = '';

                if (user.role === 'RH') {
                    sidebarLinks.innerHTML += `
                        <li><a href="/user/${user.iduser}"><span>ğŸ‘¤ Profile</span></a></li>
                        <li><a href="/contrat"><span>ğŸ“œ Contrat</span></a></li>
                        <li><a href="/sponsor"><span>ğŸ“¢ Gestion Sponsor</span></a></li>
                        <li><a href="/user"><span>ğŸ‘¥ Gestion User</span></a></li>
                        <li><a href="/event"><span>âœ… Evenements</span></a></li>
                        <li><a href="/formation"><span>ğŸ“¢ Formations</span></a></li>
                        <li><a href="/offre"><span>ğŸ¯ Offres Emploi</span></a></li>
                        <li><a href="/entretien"><span>ğŸ”¥ Entretien</span></a></li>
                        <li><a href="/mdp"><span>ğŸ”„ Mot de Passe</span></a></li>
                    `;
                } else if (user.role === 'Candidat') {
                    sidebarLinks.innerHTML += `
                                            <li><a href="/user/${user.iduser}"><span>ğŸ‘¤ Profile</span></a></li>

                        <li><a href="/"><span>ğŸ”„ Offre Emploi</span></a></li>
                        <li><a href="/reclamation/user/${user.iduser}"><span>ğŸ”„ Reclamation</span></a></li>
                        <li><a href="/"><span>ğŸ‘¥ Candidature</span></a></li>
                        <li><a href="/"><span>ğŸ‘¤ Changer Mot de Passe</span></a></li>
                    `;
                } else if (user.role === 'Employe') {
                    sidebarLinks.innerHTML += `
                        <li class="active"><a href="/user/${user.iduser}"><span>ğŸ‘¤ Profile</span></a></li>
                        <li><a href="/reclamation/user/${user.iduser}"><span>ğŸ”„ Reclamation</span></a></li>
                        <li><a href="/formation"><span>ğŸ“¢ Formation</span></a></li>
                        <li><a href="/"><span>ğŸš€ Entretien Archive</span></a></li>
                        <li><a href="/entretien/employee"><span>ğŸš€ Entretien</span></a></li>
                        <li><a href="/"><span>ğŸ¯ Mes Reservations</span></a></li>
                        <li><a href="/"><span>ğŸ‘¥ Ã‰quipe</span></a></li>
                        <li><a href="/"><span>ğŸ“‚ Projet</span></a></li>
                        <li><a href="/"><span>ğŸ”„ Mot de Passe</span></a></li>
                    `;
                } else if (user.role === 'manager') {
                    sidebarLinks.innerHTML += `
                        <li class="active"><a href="/"><span>ğŸ‘¤ Profile</span></a></li>
                        <li><a href="/"><span>âš™ï¸ Settings</span></a></li>
                    `;
                }
            } else {
                console.error('Failed to fetch user data:', data.error);
            }
        })
        .catch(error => {
            console.error('Error fetching user data:', error);
        });
    });
</script>
    {% endblock %}
</body>
</html>