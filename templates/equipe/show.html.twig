{% extends '/dashboard/manager.html.twig' %}
{% block title %}Détails de l'Équipe{% endblock %}

{% block content %}

            <div class="content container-fluid">
                <div class="row">
                    <div class="col-xl-12 col-sm-12 col-12">
                        <div class="breadcrumb-path mb-4">
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="{{ path('app_dashboard_manager') }}">Accueil</a></li>
                                <li class="breadcrumb-item"><a href="{{ path('app_equipe_index') }}">Equipe</a></li>
                                <li class="breadcrumb-item active">Détails de l'Équipe</li>
                            </ul>
                            <h3>Détails de l'Équipe</h3>
                        </div>
                    </div>
                </div>
            
          
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-titles">Informations de l'équipe</h2>
                    </div>
                    <div class="card-body">
                        {# Informations sur l'équipe #}
                        <div class="team-info d-flex align-items-center p-3 mb-4">
                            {% if equipe.imageEquipe %}
                                <img src="{{ asset(equipe.imageEquipe) }}" alt="Image de l'équipe" class="team-image">
                            {% else %}
                                <div class="team-image-placeholder">
                                    <i class="fas fa-users"></i>
                                </div>
                            {% endif %}
                            <div class="team-details ml-4">
                                <h3 class="team-name">{{ equipe.nomEquipe }}</h3>
                                <div class="team-stats">
                                    <span class="stat-item"><i class="fas fa-project-diagram"></i> {{ equipe.nbrProjet }} Projets</span>
                                    <span class="stat-item"><i class="fas fa-users"></i> {{ equipe.users|length }} Membres</span>
                                </div>
                            </div>
                        </div>
                        {# Liste des projets de l'équipe #}
                        <div class="section-title mt-5 mb-3">
                            <h4>Projets de l'équipe</h4>
                        </div>
                        
                        <div class="project-list">
                            {% if equipe.projets is not empty %}
                                {% for projet in equipe.projets %}
                                    <div class="project-card">
                                        <div class="project-image">
                                            {% if projet.imageProjet %}
                                                <img src="{{ asset(projet.imageProjet) }}" alt="Image du projet">
                                            {% else %}
                                                <div class="project-image-placeholder">
                                                    <i class="fas fa-project-diagram"></i>
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="project-details">
                                            <h5>{{ projet.nom }}</h5>
                                            <div class="project-meta">
                                                <span><i class="far fa-calendar-alt"></i> {{ projet.dateCreation|date('d/m/Y') }}</span>
                                            </div>
                                        </div>
                                        <div class="project-actions">
                                            <button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#removeProjectModal{{ projet.id }}" title="Retirer le projet">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                        
                                    <!-- Modal de suppression pour chaque projet -->
                                    <div class="modal fade" id="removeProjectModal{{ projet.id }}" tabindex="-1" role="dialog" aria-labelledby="removeProjectModalLabel{{ projet.id }}" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header text-center border-0">
                                                    <h5 class="modal-title" id="removeProjectModalLabel{{ projet.id }}">Retirer le projet</h5>
                                                </div>
                                                <div class="modal-body text-center">
                                                    <p>Vous êtes sur le point de retirer le projet "{{ projet.nom }}" de l'équipe "{{ equipe.nomEquipe }}".</p>
                                                </div>
                                                <div class="modal-footer text-center border-0">
                                                    <form method="post" action="{{ path('app_equipe_remove_project', {'id': equipe.id, 'projetId': projet.id}) }}">
                                                        <input type="hidden" name="_token" value="{{ csrf_token('remove_project_' ~ equipe.id ~ '_' ~ projet.id) }}">
                                                        <button type="submit" class="btn btn-danger">Confirmer</button>
                                                    </form>
                                                    <button type="button" class="btn btn-secondary" style="background-color: #2f8f37;" data-dismiss="modal">Annuler</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="empty-state">
                                    <i class="fas fa-project-diagram"></i>
                                    <p>Aucun projet associé à cette équipe</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    {# Boutons d'action #}
                    <div class="card-footer">
                        <div class="form-btn">
                            <a href="{{ path('app_equipe_index') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Retour
                            </a>
                            <a href="{{ path('app_equipe_edit', {'id': equipe.id}) }}" class="btn btn-primary">
                                <i class="fas fa-edit"></i> Modifier
                            </a>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


{# Script pour filtrer les membres #}
<script>
    function filterMembers() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let members = document.getElementById("memberList").getElementsByTagName("li");

        for (let i = 0; i < members.length; i++) {
            let text = members[i].textContent.toLowerCase();
            members[i].style.display = text.includes(input) ? "" : "none";
        }
    }
</script>

<style>
    /* Style général */
    .team-info {
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .team-image {
        width: 80px;
        height: 80px;
        border-radius: 8px;
        object-fit: cover;
    }
    
    .team-image-placeholder {
        width: 80px;
        height: 80px;
        border-radius: 8px;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: #6c757d;
    }
    
    .team-name {
        color: #333;
        margin-bottom: 0.5rem;
    }
    
    .team-stats {
        display: flex;
        gap: 1.5rem;
    }
    
    .stat-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #6c757d;
    }
    
    /* Style des membres */
    .member-list {
        margin-top: 1rem;
    }
    
    .member-avatar img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 1rem;
    }
    
    .member-info h5 {
        margin-bottom: 0.2rem;
        color: #333;
    }
    
    .member-info p {
        color: #6c757d;
        margin-bottom: 0;
        font-size: 0.9rem;
    }
    
    /* Style des projets */
    .project-list {
        margin-top: 1rem;
    }
    
    .project-card {
        display: flex;
        align-items: center;
        padding: 1rem;
        border-radius: 8px;
        background: #f8f9fa;
        margin-bottom: 1rem;
    }
    
    .project-image img {
        width: 60px;
        height: 60px;
        border-radius: 8px;
        object-fit: cover;
        margin-right: 1.5rem;
    }
    
    .project-image-placeholder {
        width: 60px;
        height: 60px;
        border-radius: 8px;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1.5rem;
        color: #6c757d;
    }
    
    .project-details {
        flex: 1;
    }
    
    .project-details h5 {
        color: #333;
        margin-bottom: 0.3rem;
    }
    
    .project-meta {
        display: flex;
        gap: 1rem;
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    .project-meta i {
        margin-right: 0.3rem;
    }
    
    .btn-view {
        background: #4a90e2;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        border: none;
        transition: all 0.3s;
    }
    
    .btn-view:hover {
        background: #3a7bc8;
        color: white;
        transform: translateY(-1px);
    }
    
    /* Empty state */
    .empty-state {
        text-align: center;
        padding: 2rem;
        color: #6c757d;
    }
    
    .empty-state i {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: #dee2e6;
    }
    
    /* Search box */
    .search-box {
        position: relative;
        max-width: 300px;
    }
    
    .search-icon {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .team-info {
            flex-direction: column;
            text-align: center;
        }
        
        .team-details {
            margin-left: 0;
            margin-top: 1rem;
        }
        
        .team-stats {
            justify-content: center;
        }
        
        .project-card {
            flex-direction: column;
            text-align: center;
        }
        
        .project-image, .project-image-placeholder {
            margin-right: 0;
            margin-bottom: 1rem;
        }
        
        .project-actions {
            margin-top: 1rem;
        }
    }
</style>
{% endblock %}