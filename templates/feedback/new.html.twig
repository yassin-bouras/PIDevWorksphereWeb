{% extends '/dashboard/base.html.twig' %}

{% block title %}Créer un Feedback{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .form-group {
            margin-bottom: 20px;
            padding: 10px 0;
        }
        .form-btn {
            margin-top: 30px;
            padding: 10px 0;
        }

        .form-row {
            margin-bottom: 20px; /* Add spacing below paired fields */
            padding: 0 10px; /* Add horizontal padding */
        }
        .form-col {
            padding: 0 15px; /* Add padding inside columns */
        }
        .form-btn {
            margin-top: 30px; /* Increased spacing above buttons */
            padding: 10px 0; /* Add padding for balance */
        }
        .alert-warning {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            color: #2d3748;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        .alert-warning ul {
            margin: 0;
            padding-left: 20px;
        }


        .p {
            padding: 20px ;   
        }
        .alert-warning li {
            margin-bottom: 5px;
        }
    </style>
{% endblock %}

{% block content %}
<div class="content container-fluid">
    <div class="row">
        <div class="col-xl-12 col-sm-12 col-12">
            <div class="breadcrumb-path mb-4">
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ path('app_dashboard') }}">Accueil</a></li>
                    <li class="breadcrumb-item"><a href="{{ path('entretien_by_employee') }}">Feedbacks</a></li>
                    <li class="breadcrumb-item active">Créer un Feedback</li>
                </ul>
                <h3>Créer un Nouveau Feedback</h3>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xl-12 col-sm-12 col-12">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-titles">Créer un Feedback <span>Ajoutez les informations nécessaires pour le feedback</span></h2>
                </div>
                <div class="card-body">
                    <div class="container">
                        <h1>Créer un Feedback</h1>

                        {% if entretien %}
                            <p class="p" color: #6c757d; ">
                                Pour l'entretien : <strong>{{ entretien.titre }}</strong>
                            </p>
                        {% endif %}

                        <div class="alert-warning" id="warningMessages"></div>

                        {{ form_start(form, {'attr': {'id': 'feedbackForm', 'novalidate': 'novalidate'}}) }}

                        <div class="form-group">
                            {{ form_label(form.message) }}
                            {{ form_widget(form.message, {'attr': {'class': 'form-control', 'placeholder': 'Votre message...', 'id': 'message', 'rows': '4'}}) }}
                        </div>

                        <div class="form-group">
                            {{ form_label(form.rate) }}
                            {{ form_widget(form.rate, {'attr': {'class': 'form-control', 'id': 'rate'}}) }}
                        </div>

                        {% if entretien %}
                            <input type="hidden" name="entretien" value="{{ entretien.id }}">
                        {% else %}
                            {{ form_widget(form.entretien, {'attr': {'class': 'form-control', 'id': 'entretien'}}) }}
                        {% endif %}

                        <div class="form-btn">
                            <button type="submit" class="btn btn-apply w-auto">
                                <i class="fas fa-save"></i> {{ button_label|default('Enregistrer le Feedback') }}
                            </button>
                            <a href="{{ path('entretien_by_employee') }}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Annuler
                            </a>
                        </div>

                        {{ form_end(form) }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('feedbackForm');
    const warningDiv = document.getElementById('warningMessages');

    form.addEventListener('submit', function (e) {
        let valid = true;
        let messages = [];

        warningDiv.style.display = 'none';
        warningDiv.innerHTML = '';
        const inputs = form.querySelectorAll('.form-control');
        inputs.forEach(input => input.classList.remove('is-invalid'));

        const message = document.querySelector('[id$="_message"]');
        const rate = document.querySelector('[id$="_rate"]');
        const dateFeedback = document.querySelector('[id$="_date_feedback"]');
        const entretien = document.querySelector('[id$="_entretien"]');

        if (!message.value.trim()) {
            valid = false;
            messages.push("Le message est obligatoire.");
            message.classList.add('is-invalid');
        } else if (message.value.trim().length < 10) {
            valid = false;
            messages.push("Le message doit contenir au moins 10 caractères.");
            message.classList.add('is-invalid');
        }

        const rateValue = rate.value.trim();
        if (!rateValue) {
            valid = false;
            messages.push("Veuillez sélectionner une note.");
            rate.classList.add('is-invalid');
        } else {
            const rateNum = parseInt(rateValue, 10);
            if (isNaN(rateNum) || rateNum < 1 || rateNum > 5) {
                valid = false;
                messages.push("La note doit être un nombre entre 1 et 5.");
                rate.classList.add('is-invalid');
            }
        }

        if (!valid) {
            e.preventDefault();
            warningDiv.innerHTML = '<ul>' + messages.map(msg => `<li>${msg}</li>`).join('') + '</ul>';
            warningDiv.style.display = 'block';
            window.scrollTo({ top: warningDiv.offsetTop - 20, behavior: 'smooth' });
        }
    });
});
</script>
{% endblock %}